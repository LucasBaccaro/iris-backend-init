## **SPRINT 6: Flujo de Onboarding Avanzado y Transaccional**

**Objetivo del Sprint:** Completar el flujo de onboarding para nuevos negocios, asegurando la atomicidad de la creación de múltiples entidades.

*   **3.1. Tarea: Crear los endpoints para el registro inicial del negocio (`owner`, horarios, servicios, empleados).**
    *   **Prompt para el Agente:** "Diseña un endpoint `POST /onboarding` (o similar) que permita a un `owner` recién registrado (o que aún no ha configurado su negocio) proporcionar en una sola solicitud:
        1.  Datos de su `business`.
        2.  Sus horarios de operación (ej., en una tabla `business_hours`).
        3.  Una lista inicial de `services`.
        4.  Una lista de `employees` (cuyos perfiles ya existen o se crean en ese momento).
        Este endpoint debe ser accesible solo por `owners` cuyo `business_id` en `user_profiles` aún es `NULL` o su `business` asociado está incompleto."
    *   **Entregable:** Endpoint `/onboarding` y esquemas Pydantic para los datos combinados.
    *   **Testing:** Probar el endpoint con datos completos e incompletos.
*   **3.2. Tarea: Implementar una transacción de base de datos para el onboarding atómico.**
    *   **Prompt para el Agente:** "Modifica el endpoint de onboarding (`POST /onboarding`) para que todas las operaciones de creación (negocio, horarios, servicios, empleados) se realicen dentro de una **transacción de base de datos única**. Si alguna operación dentro de la transacción falla, la transacción debe ser revertida (`ROLLBACK`), asegurando que ninguna parte del onboarding se persista si no se completa todo el proceso."
    *   **Requisito Clave:** Utilizar las capacidades transaccionales de PostgreSQL/Supabase (ej., `BEGIN; ... COMMIT;` o un gestor de contexto de transacciones en Python si se usa un ORM como SQLAlchemy).
    *   **Entregable:** Endpoint de onboarding con lógica transaccional.
    *   **Testing:** Simular el flujo de onboarding completo en una sola prueba de integración. Introducir fallos intencionales en una de las etapas (ej., datos inválidos para un servicio o empleado) y verificar que ninguna de las otras entidades se haya creado en la base de datos (rollback exitoso).

---