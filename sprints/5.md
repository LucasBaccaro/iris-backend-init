## **SPRINT 5: Sistema de Fidelización**

**Objetivo del Sprint:** Desarrollar el sistema de puntos de fidelización, incluyendo la acumulación automática y el canje de recompensas configurables.

*   **2.1. Tarea: Implementar la lógica de otorgamiento automático de puntos.**
    *   **Prompt para el Agente:** "Diseña una tabla `loyalty_points` (o un campo en `user_profiles`) para almacenar los puntos de fidelización de los clientes. Crea un mecanismo (ej., un `trigger` de base de datos o una función en la capa de servicios que se llama al `COMPLETED` de una `appointment`) que automáticamente otorgue puntos a un `customer` después de que una `appointment` se marque como `completed`."
    *   **Entregable:** Lógica de asignación automática de puntos.
    *   **Testing:** Probar la finalización de citas y verificar que los puntos se acumulan correctamente en el perfil del cliente.
*   **2.2. Tarea: Crear endpoints para la configuración de recompensas.**
    *   **Prompt para el Agente:** "Diseña una tabla `loyalty_rewards` para que el `owner` pueda definir recompensas (ej., '500 puntos = 10% de descuento', '1000 puntos = Servicio X gratis'). Crea los endpoints CRUD para `loyalty_rewards`, accesibles solo por `owners`."
    *   **Entregable:** Tabla `loyalty_rewards` y endpoints CRUD para `owners`.
    *   **Testing:** Probar la creación, lectura, actualización y borrado de recompensas por un `owner`.
*   **2.3. Tarea: Desarrollar la lógica de canje de puntos por recompensas.**
    *   **Prompt para el Agente:** "Implementa un endpoint donde un `customer` pueda canjear sus puntos por una `loyalty_reward` disponible. La lógica debe:
        1.  Verificar que el cliente tiene suficientes puntos.
        2.  Deducir los puntos del saldo del cliente.
        3.  Registrar el canje (ej., en una tabla `customer_rewards`).
        4.  Generar un código de descuento o aplicar la recompensa a la siguiente reserva."
    *   **Entregable:** Endpoint y lógica de canje de puntos.
    *   **Testing:** Probar el canje de puntos con clientes con saldo suficiente e insuficiente, verificando la deducción de puntos y el registro del canje.